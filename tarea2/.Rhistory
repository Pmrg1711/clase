#| label:  setup
source("https://inkaverse.com/docs.r")
cran <- c("devtools", "tidyverse", "openxlsx", "rMVP", "CMplot")
git <- c("hemstrow/snpR")
suppressPackageStartupMessages({
for (pkg in cran) {
if( !require(pkg, character.only = TRUE) ) {
install.packages(pkg)
library(pkg, character.only = TRUE)
}
}
for (pkg in git) {
if( !require(sub(".*/", "", pkg), character.only = TRUE) ) {
devtools::install_github(pkg, upgrade = TRUE)
library(sub(".*/", "", pkg), character.only = TRUE)
}
}
}); remove(cran, git, pkg)
cat("Project: ", getwd(), "\n")
cat("cores: ", parallel::detectCores())
cores <- parallel::detectCores()*0.8
session_info()
#| eval: false
plink2 --ped RiceDiversity/sativas413.ped \
plink2 --ped C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data
#| label:  setup
source("https://inkaverse.com/docs.r")
cran <- c("devtools", "tidyverse", "openxlsx", "rMVP", "CMplot")
git <- c("hemstrow/snpR")
library(readxl)
library(data.table)
library(dplyr)
library(ggplot2)
suppressPackageStartupMessages({
for (pkg in cran) {
if( !require(pkg, character.only = TRUE) ) {
install.packages(pkg)
library(pkg, character.only = TRUE)
}
}
for (pkg in git) {
if( !require(sub(".*/", "", pkg), character.only = TRUE) ) {
devtools::install_github(pkg, upgrade = TRUE)
library(sub(".*/", "", pkg), character.only = TRUE)
}
}
}); remove(cran, git, pkg)
cat("Project: ", getwd(), "\n")
cat("cores: ", parallel::detectCores())
cores <- parallel::detectCores()*0.8
session_info()
load("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Data Sheet 1.CSV")
table1 <- read_excel("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Table 1.xlsx")
table2 <- read_excel("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Table 2.xlsx")
# Data Sheet 1: Datos genotípicos (probablemente matriz de SNPs o alelos)
data_geno <- fread("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Data Sheet 1.CSV")
#| label:  setup
source("https://inkaverse.com/docs.r")
cran <- c("devtools", "tidyverse", "openxlsx", "rMVP", "CMplot")
git <- c("hemstrow/snpR")
library(readxl)
library(data.table)
library(dplyr)
library(ggplot2)
suppressPackageStartupMessages({
for (pkg in cran) {
if( !require(pkg, character.only = TRUE) ) {
install.packages(pkg)
library(pkg, character.only = TRUE)
}
}
for (pkg in git) {
if( !require(sub(".*/", "", pkg), character.only = TRUE) ) {
devtools::install_github(pkg, upgrade = TRUE)
library(sub(".*/", "", pkg), character.only = TRUE)
}
}
}); remove(cran, git, pkg)
cat("Project: ", getwd(), "\n")
cat("cores: ", parallel::detectCores())
cores <- parallel::detectCores()*0.8
session_info()
# Table 1: Información de clones y fenotipos
table1 <- read_excel("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Table 1.xlsx")
# Table 2: Resultados de modelos o correlaciones (por ejemplo, predicción genómica)
table2 <- read_excel("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Table 2.xlsx")
# Data Sheet 1: Datos genotípicos (probablemente matriz de SNPs o alelos)
data_geno <- fread("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/Data Sheet 1.CSV")
cat("\nEstructura de los archivos:\n")
at("\nEstructura de los archivos:\n")
cat("Table 1:\n"); print(dim(table1)); print(names(table1))
cat("\nTable 2:\n"); print(dim(table2)); print(names(table2))
cat("\nData Sheet 1:\n"); print(dim(data_geno)); print(names(data_geno)[1:10])
id_col <- names(table1)[1]   # primera columna como ID (ajustar si es necesario)
if (id_col %in% names(data_geno)) {
id_col <- names(table1)[1]   # primera columna como ID (ajustar si es necesario)
if (id_col %in% names(data_geno)) {
cat("\nLos IDs de clones coinciden entre archivos.\n")
} else {
cat("\n⚠️ Atención: los IDs no coinciden directamente. Revisa nombres de columnas.\n")
}
table1 <- table1 %>%
mutate(across(where(is.character), as.factor))
if (any(grepl("Yield|Dry|Chip|Senescence", names(table1), ignore.case = TRUE))) {
traits <- grep("Yield|Dry|Chip|Senescence", names(table1), ignore.case = TRUE, value = TRUE)
cat("\nResumen de fenotipos:\n")
print(summary(select(table1, all_of(traits))))
# Graficar un fenotipo ejemplo
ggplot(table1, aes_string(x = traits[1])) +
geom_histogram(fill = "darkcyan", color = "white", bins = 30) +
theme_minimal(base_size = 13) +
labs(title = paste("Distribución de", traits[1]), x = traits[1], y = "Frecuencia")
}
if (ncol(data_geno) > 10) {
print(data_geno[1:5, 1:10])
}
table1$Model <- "Model1"
table2$Model <- "Model2"
gwas_all <- bind_rows(table1, table2)
gwas_all <- gwas_all %>%
filter(!is.na(`p-value`), `p-value` > 0, `p-value` < 1)
CMplot(gwas_all,
plot.type = "m",
col = c("blue4", "orange3"),
LOG10 = TRUE,
threshold = 0.05 / nrow(gwas_all),  # Bonferroni
threshold.col = "red",
cex = 0.6,
chr.den.col = "gray70",
highlight = NULL,
main = "Comparación de GWAS: Model1 vs Model2",
file = "jpg")
ggplot(gwas_all, aes(x = -log10(`p-value`), fill = Model)) +
geom_histogram(position = "identity", alpha = 0.6, bins = 50) +
theme_minimal(base_size = 13) +
labs(x = "-log10(p)", y = "Frecuencia", title = "Distribución de valores p") +
scale_fill_manual(values = c("blue4", "orange3"))
cat("\nEstructura de archivos:\n")
print(list(
Table1 = dim(table1),
Table2 = dim(table2),
Geno_Info = dim(geno_info)
))
# ==== 4. Combinar resultados GWAS (comparación de modelos) ====
table1$Model <- "Model1"
table2$Model <- "Model2"
gwas_all <- bind_rows(table1, table2)
# Asegurar formato correcto
gwas_all <- gwas_all %>%
rename(P = `p-value`, CHR = Chr, POS = Pos) %>%
mutate(CHR = as.numeric(CHR), POS = as.numeric(POS)) %>%
filter(!is.na(P), P > 0, P < 1)
CMplot(gwas_all,
plot.type = "m",
LOG10 = TRUE,
threshold = 0.05 / nrow(gwas_all), # umbral Bonferroni
threshold.col = "red",
col = c("steelblue4", "orange3"),
main = "Comparación de GWAS: Model1 vs Model2",
file = "jpg",
file.output = TRUE)
ggplot(gwas_all, aes(x = -log10(P), fill = Model)) +
geom_histogram(position = "identity", alpha = 0.6, bins = 40) +
theme_minimal(base_size = 13) +
labs(x = "-log10(p)", y = "Frecuencia",
title = "Distribución de valores p por modelo") +
scale_fill_manual(values = c("steelblue4", "orange3"))
set.seed(42)
n.ind <- 100   # individuos simulados
n.snp <- 5000  # SNPs simulados
geno_sim <- matrix(sample(0:4, n.ind * n.snp, replace = TRUE), nrow = n.ind)
pheno_sim <- data.frame(ID = paste0("clone_", 1:n.ind),
Trait = rnorm(n.ind, mean = 30, sd = 5))
MVP.Data(fileVCF = NULL,
fileHMP = NULL,
fileNum = geno_sim,
filePhe = pheno_sim,
out = "potato_MVP",
sep.hapmap = "\t",
sep.phe = "\t")
geno_path <- "potato_MVP.pgeno"
pheno_path <- "potato_MVP.phe"
genotype <- MVP.Data(fileNum = geno_path)
phenotype <- read.table(pheno_path, header = TRUE)
K <- MVP.K.VanRaden(genotype)
save(K, file = "potato_Kinship.rda")
# Modelo mixto lineal
MVP.GWAS(
phe = phenotype,
geno = genotype,
K = K,
method = "MLM",
permutation.threshold = TRUE,
nPC.GLM = 3,
priority = "speed",
file.output = TRUE,
outpath = "GWAS_results"
)
cat("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/GWAS_results'\n")
cat("C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/GWAS_results")
library(magick)
img_path <- "C:/Users/pmrg1/OneDrive/Desktop/git/bamg/tarea2/data/GWAS_results/MVP.MLM.manhattan.jpg"
img <- image_read(img_path)
print(img)
browseURL(img_path)
